<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HabitFlow</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg:#1e1e1e;
  --panel:#252525;
  --panel2:#2d2d2d;
  --text:#fff;
  --muted:#aaa;
  --accent:#4CAF50;
  --danger:#f44336;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui;
  background:var(--bg);
  color:var(--text);
}

.app{
  display:flex;
  height:100vh;
}

aside{
  width:250px;
  background:var(--panel);
  padding:24px;
}

aside h1{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:32px;
}

nav a{
  display:flex;
  gap:10px;
  padding:12px;
  border-radius:8px;
  color:var(--muted);
  cursor:pointer;
}
nav a.active,nav a:hover{
  background:var(--panel2);
  color:var(--accent);
}

main{
  flex:1;
  padding:24px;
  overflow:auto;
}

.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
  margin-bottom:24px;
}

.stat{
  background:var(--panel);
  padding:16px;
  border-radius:12px;
  text-align:center;
}

.stat h2{
  color:var(--accent);
  margin:0;
}

.grid{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:24px;
}

.card{
  background:var(--panel);
  border-radius:12px;
  padding:16px;
}

.habit{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  background:var(--panel2);
  border-radius:8px;
  margin-bottom:10px;
}

.habit.done{
  opacity:.5;
  text-decoration:line-through;
}

button{
  background:var(--accent);
  border:none;
  padding:10px 16px;
  border-radius:8px;
  color:#fff;
  cursor:pointer;
}

button.danger{
  background:var(--danger);
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal.active{display:flex}

.modal-content{
  background:var(--panel);
  padding:24px;
  border-radius:12px;
  width:90%;
  max-width:400px;
}
</style>
</head>

<body>
<div class="app">

<aside>
  <h1>âœ” HabitFlow</h1>
  <nav>
    <a class="active">Dashboard</a>
  </nav>
</aside>

<main>
  <h1>Dashboard</h1>

  <div class="stats">
    <div class="stat"><h2 id="completionRate">0%</h2><p>Completion</p></div>
    <div class="stat"><h2 id="bestStreak">0</h2><p>Best Streak</p></div>
    <div class="stat"><h2 id="totalHabits">0</h2><p>Total Habits</p></div>
    <div class="stat"><h2 id="doneToday">0</h2><p>Done Today</p></div>
  </div>

  <div class="grid">
    <div class="card">
      <canvas id="chart" height="120"></canvas>
    </div>

    <div class="card">
      <button onclick="openModal()">+ New Habit</button>
      <div id="habitList" style="margin-top:16px"></div>
    </div>
  </div>
</main>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>Add Habit</h2>
    <form onsubmit="submitHabit(event)">
      <input required placeholder="Habit name" id="hName" style="width:100%;padding:10px"><br><br>
      <textarea placeholder="Description" id="hDesc" style="width:100%;padding:10px"></textarea><br><br>
      <button>Add</button>
    </form>
  </div>
</div>

<script>
/* =========================
   STATE + STORAGE (OLD LOGIC)
========================= */

const HABITS_KEY = 'hf_habits';
const ENTRIES_KEY = 'hf_entries';

const store = {
  habits: [],
  entries: [],
  date: new Date()
};

const Service = {
  init(){
    store.habits = JSON.parse(localStorage.getItem(HABITS_KEY)) || [];
    store.entries = JSON.parse(localStorage.getItem(ENTRIES_KEY)) || [];
    render();
  },

  save(){
    localStorage.setItem(HABITS_KEY,JSON.stringify(store.habits));
    localStorage.setItem(ENTRIES_KEY,JSON.stringify(store.entries));
  },

  addHabit(name,desc){
    store.habits.push({
      id:crypto.randomUUID(),
      name,desc,
      created:new Date().toISOString(),
      streak:0
    });
    this.save(); render();
  },

  toggle(hid){
    const d = store.date.toISOString().split('T')[0];
    let e = store.entries.find(x=>x.habitId===hid && x.date===d);
    if(e){e.completed=!e.completed}
    else store.entries.push({id:crypto.randomUUID(),habitId:hid,date:d,completed:true});
    this.updateStreak(hid);
    this.save(); render();
  },

  updateStreak(hid){
    const h = store.habits.find(x=>x.id===hid);
    let dates = store.entries.filter(e=>e.habitId===hid && e.completed).map(e=>e.date);
    let d=new Date();d.setHours(0,0,0,0);
    let s=0;
    while(dates.includes(d.toISOString().split('T')[0])){
      s++; d.setDate(d.getDate()-1);
    }
    h.streak=s;
  }
};

/* =========================
   UI RENDERING
========================= */

let chart;

function render(){
  renderHabits();
  renderStats();
  renderChart();
}

function renderHabits(){
  const d = store.date.toISOString().split('T')[0];
  const el = document.getElementById('habitList');
  el.innerHTML='';
  store.habits.forEach(h=>{
    const done = store.entries.some(e=>e.habitId===h.id && e.date===d && e.completed);
    const div=document.createElement('div');
    div.className='habit'+(done?' done':'');
    div.innerHTML=`
      <input type="checkbox" ${done?'checked':''}>
      <div style="flex:1">${h.name}<br><small>ðŸ”¥ ${h.streak}</small></div>
    `;
    div.querySelector('input').onchange=()=>Service.toggle(h.id);
    el.appendChild(div);
  });
}

function renderStats(){
  const d = store.date.toISOString().split('T')[0];
  const total=store.habits.length;
  const done=store.entries.filter(e=>e.date===d && e.completed).length;
  document.getElementById('totalHabits').textContent=total;
  document.getElementById('doneToday').textContent=done;
  document.getElementById('completionRate').textContent=total?Math.round(done/total*100)+'%':'0%';
  document.getElementById('bestStreak').textContent=Math.max(0,...store.habits.map(h=>h.streak));
}

function renderChart(){
  const labels=[],data=[];
  for(let i=6;i>=0;i--){
    const d=new Date();d.setDate(d.getDate()-i);
    const ds=d.toISOString().split('T')[0];
    labels.push(d.toLocaleDateString('en',{weekday:'short'}));
    data.push(store.entries.filter(e=>e.date===ds && e.completed).length);
  }
  if(chart)chart.destroy();
  chart=new Chart(document.getElementById('chart'),{
    type:'line',
    data:{labels,datasets:[{data,borderColor:'#4CAF50',fill:false}]},
    options:{plugins:{legend:{display:false}}}
  });
}

/* =========================
   MODAL
========================= */
function openModal(){document.getElementById('modal').classList.add('active')}
function submitHabit(e){
  e.preventDefault();
  Service.addHabit(hName.value,hDesc.value);
  modal.classList.remove('active');
  e.target.reset();
}

/* =========================
   INIT
========================= */
Service.init();
</script>

</body>
</html>
